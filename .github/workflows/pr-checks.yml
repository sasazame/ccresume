name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  size-check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Check PR size
      uses: actions/github-script@v7
      with:
        script: |
          const pr = context.payload.pull_request;
          const { additions, deletions } = pr;
          const totalChanges = additions + deletions;
          
          let message = '';
          let label = '';
          
          if (totalChanges < 10) {
            label = 'size/XS';
            message = 'ðŸ‘Œ This PR is very small (< 10 lines)';
          } else if (totalChanges < 50) {
            label = 'size/S';
            message = 'âœ… This PR is small (< 50 lines)';
          } else if (totalChanges < 200) {
            label = 'size/M';
            message = 'ðŸ“Š This PR is medium-sized (< 200 lines)';
          } else if (totalChanges < 500) {
            label = 'size/L';
            message = 'âš ï¸ This PR is large (< 500 lines)';
          } else {
            label = 'size/XL';
            message = 'ðŸš¨ This PR is very large (>= 500 lines). Consider breaking it up.';
          }
          
          // Add label
          await github.rest.issues.addLabels({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: pr.number,
            labels: [label]
          });
          
          // Add comment
          await github.rest.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: pr.number,
            body: `## PR Size Check\n\n${message}\n\n- Additions: ${additions}\n- Deletions: ${deletions}\n- Total: ${totalChanges}`
          });

  conventional-commits:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Check commit messages
      uses: wagoid/commitlint-github-action@v5
      with:
        configFile: .commitlintrc.json
        failOnWarnings: false